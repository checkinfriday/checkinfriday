<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Check-in de Presença</title>
</head>
<body>

<h2>Check-in de Presença</h2>

<label>Aluno</label><br>
<select id="aluno">
  <option>Carregando alunos...</option>
</select>

<br><br>

<label>Horário</label><br>
<select id="horario">
  <option value="">Selecione</option>
  <option>08:00</option>
  <option>10:00</option>
  <option>14:00</option>
</select>

<br><br>

<button onclick="checkin()">Fazer Check-in</button>

<p id="msg"></p>

<script>
const ENDPOINT = "https://script.google.com/macros/s/AKfycbznxOx8kd7uQ_KrFOJKhw1vZ2QDI0unlzcr4a49Rsw4x9FefwaQdxJOY8YaWhnI_v7fzQ/exec";
const TOKEN = "TOKEN_SECRETO_FORTE";

function carregarAlunos() {
  fetch(`${ENDPOINT}?action=alunos&token=${TOKEN}`)
    .then(r => r.json())
    .then(data => {
      const select = document.getElementById("aluno");
      select.innerHTML = '<option value="">Selecione seu nome</option>';

      data.alunos.forEach(nome => {
        const opt = document.createElement("option");
        opt.value = nome;
        opt.textContent = nome;
        select.appendChild(opt);
      });
    })
    .catch(() => {
      document.getElementById("aluno").innerHTML =
        "<option>Erro ao carregar</option>";
    });
}

function checkin() {
  const aluno = document.getElementById("aluno").value;
  const horario = document.getElementById("horario").value;

  if (!aluno || !horario) {
    alert("Preencha todos os campos");
    return;
  }

  const payload = JSON.stringify({ aluno, horario });

  // Removendo o header Content-Type para evitar erro de CORS/Preflight
  fetch(`${ENDPOINT}?token=${TOKEN}`, {
    method: "POST",
    body: payload 
  })
  .then(r => r.json())
  .then(data => {
    if (data.ok) {
      document.getElementById("msg").innerText = "Presença registrada!";
      document.getElementById("msg").style.color = "green";
    } else {
      document.getElementById("msg").innerText = "Erro: " + data.erro;
    }
  })
  .catch(err => {
    console.error(err);
    document.getElementById("msg").innerText = "Erro na comunicação com o servidor";
  });
}

carregarAlunos();
</script>

</body>
</html>
